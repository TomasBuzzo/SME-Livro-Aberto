{% extends 'base.html'  %}{% load static %}

{% block title %}Mosaico{% endblock %}

{%block head %}
  <link rel="stylesheet" href="{% static 'css/mosaico.css' %}">
  <script src="{% static 'js/treemap.js' %}"></script>
  <script src="{% static 'js/timeseries.js' %}"></script>
{% endblock %}

{%block header %}
  <h1>Mosaico Orçamentário</h1>
  <p>Orçamento da Educação ao seu alcance</p>
{% endblock %}

{%block sections %}
  <section id="mosaic">
    <div class="wrapper">

      <form action="" method="get" class="query">
      <fieldset>
        <legend>
          Visualizar
        </legend>
        <div class="form-item switch">
          <input class="radio" type="radio" name="break" checked id="by-orgao">
          <label for="by-orgao">Por órgão</label>
          <input class="radio" type="radio" name="break" value="" id="by-area">
          <label for="by-area">Por área</label>
        </div>
        <div class="form-item">
          <input class="radio" type="radio" name="universe" value="">
          <label>Educação</label>
          <input class="radio" type="radio" name="universe" value="">
          <label>Mínimo constitucional</label>
        </div>
        <select name="year">
          <option value="2018">2018</option>
          <option value="2017">2017</option>
          <option value="2016">2016</option>
          <option value="2015">2015</option>
          <option value="2014">2014</option>
        </select>
      </fieldset>
      </form>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li><a href="#">Ano 2019</a></li>
          <li class="active" aria-current="page"><span>Apoio ao Aluno</span></li>
        </ol>
      </nav>
      <ol class="treemap">
          {% for execucao in execucoes %}
          <li data-execution="{{ execucao.percentual_empenhado}}" data-value="{{ execucao.orcado_total }}">
                  <div class="value">R$ {{ execucao.orcado_total }} </div>
		  <div class="name"><a href="{{ execucao.url}}">{{ execucao.nome }}</a></div>
                  <div class="execution">{% widthratio execucao.percentual_empenhado 1 100 %}%</div>
              </li>
          {% endfor %}
      </ol>
      <style type="text/css">
        .treemap{
            position: relative;
            padding: 0;
            width: 100%;
            height: 35rem;
        }
        .treemap > li{
            position: absolute;
            overflow: hidden;
            box-sizing: border-box;
        }
        .treemap > li > div:first-child{
            padding-top: 1em;
        }
        .treemap > li > div{
            padding-left: 1em;
            white-space: nowrap;
            text-overflow: clip;
        }
        .treemap > li .name{
            font-weight: 700;
        }
      </style>
      <footer>
          <div class="legend">
              {# TODO: think on a progressive strategy of loading legend #}
              <img src="{% static 'img/escala_cor_mosaico.svg' %}" width="400" alt="">
          </div>
          <div class="actions">
              <a class="btn" href="">Dados do gráfico</a>
              <a class="btn" href="">Dados da tela</a>
          </div>
      </footer>
    </div>
  </section>
  <section id="budget-over-time">
    <div class="wrapper">
      <h2>Orçamento x <em>Tempo</em></h2>
      <form action="" method="get" class="query">
      <fieldset>
        <legend>
          Visualizar
        </legend>
        <div class="form-item switch">
          <input type="checkbox" name="break" checked id="use-deflator">
          <label for="use-deflator">Valores corrigidos</label>
          <label for="use-deflator">Valores correntes</label>
        </div>
      </fieldset>
      </form>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li><a href="#">Ano 2019</a></li>
          <li class="active" aria-current="page"><span>Apoio ao Aluno</span></li>
        </ol>
      </nav>
      <div class="timeseries">
          <style type="text/css">
            .timeseries svg{
                width: 100%;
            }
            path.line{
                fill: transparent;
                stroke-width: 2;
            }

            .axis--x path,
            .axis--y path {
                stroke: none;
            }

            .axis line {
                fill: none;
                stroke: #5f6b6d;
                shape-rendering: crispEdges;
            }

            text{
                font-weight: 700;
                color: #5f6b6d;
            }
          </style>
          <table>
              <thead>
                  <tr>
                      <th>Ano</th>
                      <th>Valor atualizado</th>
                      <th>Valor pago</th>
                  </tr>
              </thead>
              <tbody>
		  {% for year, values in timeseries.items %}
                  <tr>
			  <th data-year="{{ year }}">{{ year }}</th>
			  <td data-updated="{{ values.orcado }}">R${{ values.orcado }}</td>
			  <td data-paid="{{ values.empenhado }}">R${{ values.empenhado }}</td>
                  </tr>
		  {% endfor %}
              </tbody>
          </table>
      </div>
    </div>
  </section>
  <section id="data-table">
    <div class="wrapper">
      <h2><em>Tabela</em> de Dados</h2>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li><a href="#">Ano 2019</a></li>
          <li class="active" aria-current="page"><span>Apoio ao Aluno</span></li>
        </ol>
      </nav>
      <table>
          <thead>
              <tr>
                  <th>Área</th>
                  <th>Orçamento</th>
                  <th>Empenhado</th>
                  <th>Execução</th>
              </tr>
          </thead>
          <tbody>
          {% for execucao in execucoes %}
              <tr>
                  <th>{{ execucao.nome }}</th>
                  <td>R$ {{ execucao.orcado_total }} </td>
                  <td>R$ {{ execucao.empenhado_total}} </td>
                  <td>{% widthratio execucao.percentual_empenhado 1 100 %}%</td>
              </tr>
          {% endfor %}
          </tbody>
      </table>
    </div>
  </section>
{% endblock %}
